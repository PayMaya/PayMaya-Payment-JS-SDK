/* global ActiveXObject: false */
var PayMaya=PayMaya||{};PayMaya.Payments=function(pfKey){this.pfKey=pfKey;
// Private Method/function
var getXMLHttpRequest=function(){var xhttp=null;if(window.XMLHttpRequest)
// Chome, Firefox, Opera 8.0+, Safari
xhttp=new window.XMLHttpRequest;else try{
// Internet Explorer
xhttp=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(ex){return null}return xhttp};
// Private Method/function
this.onFormProcessing=function(pfKey,paymentForm,formObj){var body,dataArr,request,encodedData,errorMessage;/* if(paymentForm === "") {
      errorMessage = 'Please specify a css class id in your form tag.';
      return formObj.failure(errorMessage);
    } */
return body={card:{number:formObj.cardNumber,cvc:formObj.cardCvc,expMonth:formObj.cardExpiryMonth,expYear:formObj.cardExpiryYear}},request=getXMLHttpRequest(),null===request?(errorMessage="AJAX (XMLHTTP) not supported.",formObj.failure(errorMessage)):(request.open("POST","http://private-anon-5c87df497-paymayapaymentsapi.apiary-mock.com/payment-tokens"),request.setRequestHeader("Content-Type","application/json"),encodedData=btoa(pfKey),request.setRequestHeader("Authorization","Basic "+encodedData),request.onreadystatechange=function(){if(4===request.readyState){if(200!==request.status)return errorMessage="Error",formObj.failure(errorMessage);if(dataArr=JSON.parse(request.responseText),dataArr.hasOwnProperty("id")&&""!==dataArr.id&&"created"===dataArr.state)return formObj.success(dataArr);if(dataArr.hasOwnProperty("id")&&""!==dataArr.id&&"used"===dataArr.state)return errorMessage='State has been change from "created" to "used"',formObj.failure(errorMessage);if(dataArr.hasOwnProperty("category")&&"payments-error"===dataArr.category&&"5001"===dataArr.code)return formObj.failure(dataArr.message)}},request.send(JSON.stringify(body)),void 0)}},PayMaya.Payments.prototype.createPaymentToken=function(paymentForm,cardNumber,cardCvc,cardExpiryMonth,cardExpiryYear,success,failure){return this.paymentForm=paymentForm,this.formObj={cardNumber:cardNumber,cardCvc:cardCvc,cardExpiryMonth:cardExpiryMonth,cardExpiryYear:cardExpiryYear,success:success,failure:failure},this.onFormProcessing(this.pfKey,this.paymentForm,this.formObj)};