/* global ActiveXObject: false */
var PayMaya=PayMaya||{};PayMaya.Payments=function(pfKey){this.pfKey=pfKey},PayMaya.Payments.prototype.createPaymentToken=function(paymentForm,cardNumber,cardCvc,cardExpiryMonth,cardExpiryYear,success,failure){this.paymentForm=paymentForm;var formObj={cardNumber:cardNumber.value,cardCvc:cardCvc.value,cardExpiryMonth:cardExpiryMonth.value,cardExpiryYear:cardExpiryYear.value,success:success,failure:failure};return PayMaya.Payments.onFormProcessing(this.pfKey,this.paymentForm,formObj)},PayMaya.Payments.onFormProcessing=function(pfKey,paymentForm,formObj){var body,dataArr,request,encodedData,errorMessage;body={card:{number:formObj.cardNumber,cvc:formObj.cardCvc,expMonth:formObj.cardExpiryMonth,expYear:formObj.cardExpiryYear}},request=PayMaya.Payments.getXMLHttpRequest(),null!==request?(request.open("POST","http://private-anon-5c87df497-paymayapaymentsapi.apiary-mock.com/payment-tokens"),request.setRequestHeader("Content-Type","application/json"),encodedData=btoa(pfKey),request.setRequestHeader("Authorization","Basic "+encodedData),request.onreadystatechange=function(){4===request.readyState&&(200===request.status?(dataArr=JSON.parse(request.responseText),dataArr.hasOwnProperty("id")&&""!==dataArr.id&&"created"===dataArr.state?formObj.success(dataArr):dataArr.hasOwnProperty("id")&&""!==dataArr.id&&"used"===dataArr.state&&(errorMessage='State has been change from "created" to "used"',formObj.failure(errorMessage)),dataArr.hasOwnProperty("category")&&"payments-error"===dataArr.category&&"5001"===dataArr.code&&formObj.failure(dataArr.message)):(errorMessage="Error",formObj.failure(errorMessage)))},request.send(JSON.stringify(body))):(errorMessage="AJAX (XMLHTTP) not supported.",formObj.failure(errorMessage))},PayMaya.Payments.getXMLHttpRequest=function(){var xhttp=null;if(window.XMLHttpRequest)
// Chome, Firefox, Opera 8.0+, Safari
xhttp=new window.XMLHttpRequest;else try{
// Internet Explorer
xhttp=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(ex){return null}return xhttp};