/* global ActiveXObject: false */
var PayMaya=PayMaya||{};PayMaya.Payments=function(env,pfKey){this.pfKey=pfKey,this.env=env;var getXMLHttpRequest=function(){var xhttp=null;if(window.XMLHttpRequest)
// Chome, Firefox, Opera 8.0+, Safari
xhttp=new window.XMLHttpRequest;else try{
// Internet Explorer
xhttp=new ActiveXObject("MSXML2.XMLHTTP.3.0")}catch(ex){return null}return xhttp};this.onFormProcessing=function(pfKey,paymentForm,formObj){var url,env,body,dataArr,request,encodedData,errorMessage;// TODO - Put production endpoint here
return env=this.env,""===env?(errorMessage="Environment is not set",formObj.failure(errorMessage)):("sandbox"===env?(url="https://api.paymaya.com/sandbox/payments/payment-tokens",console.log(url)):"production"===env&&(url="production endpoint",console.log(url)),body={card:{number:formObj.cardNumber.value,cvc:formObj.cardCvc.value,expMonth:formObj.cardExpiryMonth.value,expYear:formObj.cardExpiryYear.value}},console.log(body),request=getXMLHttpRequest(),null===request?(errorMessage="AJAX (XMLHTTP) not supported.",formObj.failure(errorMessage)):(request.open("POST",url,!0),request.setRequestHeader("Content-Type","application/json"),encodedData=btoa(pfKey),request.setRequestHeader("Authorization","Basic "+encodedData),request.onreadystatechange=function(){if(4===request.readyState){if(console.log("Status:",this.status),console.log("Headers:",this.getAllResponseHeaders()),console.log("Body:",this.responseText),200!==request.status)return errorMessage="Error",formObj.failure(errorMessage);if(dataArr=JSON.parse(request.responseText),console.log(dataArr),dataArr.hasOwnProperty("paymentTokenId")&&""!==dataArr.paymentTokenId&&"created"===dataArr.state)return formObj.success(dataArr);if(dataArr.hasOwnProperty("paymentTokenId")&&""!==dataArr.paymentTokenId&&"used"===dataArr.state)return errorMessage='State has been change from "created" to "used"',formObj.failure(errorMessage);if(dataArr.hasOwnProperty("category")&&"payments-error"===dataArr.category&&"5001"===dataArr.code)return formObj.failure(dataArr.message)}},request.send(JSON.stringify(body)),void 0))}},PayMaya.Payments.prototype.createPaymentToken=function(paymentForm,cardNumber,cardCvc,cardExpiryMonth,cardExpiryYear,success,failure){return this.paymentForm=paymentForm,this.formObj={cardNumber:cardNumber,cardCvc:cardCvc,cardExpiryMonth:cardExpiryMonth,cardExpiryYear:cardExpiryYear,success:success,failure:failure},this.onFormProcessing(this.pfKey,this.paymentForm,this.formObj)};